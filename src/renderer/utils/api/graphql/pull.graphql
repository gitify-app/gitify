#import './common.graphql'

query FetchPullRequestByNumber(
  $owner: String!
  $name: String!
  $number: Int!
  $firstLabels: Int
  $lastComments: Int
  $lastReviews: Int
  $firstClosingIssues: Int
  $includeMetrics: Boolean!
) {
  repository(owner: $owner, name: $name) {
    pullRequest(number: $number) {
      ...PullRequestDetails
    }
  }
}

fragment PullRequestDetails on PullRequest {
  __typename
  number
  title
  url
  state
  merged
  isDraft
  isInMergeQueue

  author {
    ...AuthorFields
  }

  comments(last: $lastComments) {
    totalCount
    nodes {
      url
      author {
        ...AuthorFields
      }

      # Reactions
      ... @include(if: $includeMetrics) {
        reactions {
          totalCount
        }
        reactionGroups {
          ...ReactionGroupFields
        }
      }
    }
  }

  ...PullRequestMetrics @include(if: $includeMetrics)
}

fragment PullRequestReviewFields on PullRequestReview {
  state
  author {
    login
  }
}

fragment PullRequestMetrics on PullRequest {
  # Linked Issues
  closingIssuesReferences(first: $firstClosingIssues) {
    nodes {
      number
    }
  }

  # Reactions
  reactions {
    totalCount
  }
  reactionGroups {
    ...ReactionGroupFields
  }

  # Reviews
  reviews(last: $lastReviews) {
    totalCount
    nodes {
      ...PullRequestReviewFields
    }
  }

  # Labels
  labels(first: $firstLabels) {
    nodes {
      name
    }
  }

  # Milestone
  milestone {
    ...MilestoneFields
  }
}
